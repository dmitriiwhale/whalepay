# Crypto Store Telegram Bot

Telegram бот для продажи цифровых товаров за криптовалюту с возможностью выбора валюты оплаты.

## Особенности

- Модульная архитектура
- Отображение цен в рублях с конвертацией в USD и криптовалюты
- Возможность выбора криптовалюты для оплаты
- Интеграция с Crypto Pay API
- Удобный скрипт для добавления товаров
- Поддержка нескольких криптовалют: TON, BTC, USDT, USDC, BUSD
- Система доставки цифровых товаров в виде файлов
- Система поддержки пользователей с тикетами и ответами

## Структура проекта

```
├── bot/
│   ├── __init__.py
│   ├── main.py            # Точка входа для бота
│   ├── config/            # Конфигурация и настройки
│   │   ├── __init__.py
│   │   ├── config.py      # Основные настройки
│   │   └── products.py    # Конфигурация товаров и файлов
│   ├── files/             # Директория для файлов товаров
│   │   └── snake_game.py  # Пример файла товара
│   ├── database/          # Модуль для работы с БД
│   │   ├── __init__.py
│   │   └── db.py
│   ├── handlers/          # Обработчики команд и колбэков
│   │   ├── __init__.py
│   │   ├── handlers.py
│   │   └── support_handlers.py  # Обработчики для системы поддержки
│   ├── keyboards/         # Клавиатуры и кнопки
│   │   ├── __init__.py
│   │   └── keyboards.py
│   ├── services/          # Сервисы для работы с API
│   │   ├── __init__.py
│   │   └── crypto_service.py
│   └── utils/             # Вспомогательные утилиты
│       ├── __init__.py
│       └── product_manager.py
├── main.py                # Запуск бота
├── add_product.py         # Скрипт для добавления товаров
├── crypto_store.db        # База данных SQLite
└── README.md              # Документация
```

## Установка и запуск

1. Установите необходимые зависимости:

```bash
pip install aiogram crypto-pay-api-sdk aiohttp
```

2. Настройте токены в файле `bot/config/config.py`:

```python
TELEGRAM_BOT_TOKEN = "ваш_токен_бота"
CRYPTO_PAY_TOKEN = "ваш_токен_crypto_pay"
TESTNET = True  # Установите False для работы в основной сети

# Настройки поддержки
SUPPORT_ENABLED = True
SUPPORT_CHAT_ID = 123456789  # ID чата поддержки
SUPPORT_ADMIN_IDS = [123456789]  # Список ID администраторов поддержки
```

3. Настройте файлы товаров в `bot/config/products.py`:

```python
PRODUCT_FILES = {
    1: {
        "file_path": "bot/files/snake_game.py",
        "file_name": "snake_game.py",
        "description": "Секрет",
        "type": "file"
    },
    2: {
        "file_path": "bot/files/defi_guide.pdf",
        "file_name": "Complete Guide to DeFi.pdf",
        "description": "Полное руководство по DeFi",
        "type": "file"
    }
}
```

4. Запустите бота:

```bash
python main.py
```

## Добавление товаров

### Интерактивный режим

```bash
python add_product.py --interactive
```

Следуйте инструкциям в консоли для добавления товара.

### Через аргументы командной строки

```bash
python add_product.py --name "Название товара" --description "Описание товара" --price 1000 --image-url "https://example.com/image.jpg" --currencies "TON,BTC,USDT"
```

Параметры:
- `--name`, `-n`: Название товара
- `--description`, `-d`: Описание товара
- `--price`, `-p`: Цена в рублях
- `--image-url`, `-img`: URL изображения товара (опционально)
- `--currencies`, `-c`: Список поддерживаемых валют через запятую (опционально, по умолчанию все)

## Конвертация валют

Бот автоматически конвертирует цены из рублей в USD и криптовалюты, используя следующие API:
- Exchange Rate API для конвертации RUB → USD
- CoinGecko API для конвертации USD → криптовалюты

## Процесс покупки

1. Пользователь выбирает товар из каталога
2. Пользователь выбирает криптовалюту для оплаты
3. Бот создает счет через Crypto Pay API
4. Пользователь оплачивает счет
5. Бот проверяет статус оплаты и доставляет товар

## Система доставки товаров

После успешной оплаты бот автоматически доставляет цифровой товар пользователю:

1. Для товаров типа "file" - отправляет файл из указанного пути
2. Для товаров типа "text" - отправляет текстовое сообщение с информацией

Конфигурация товаров и их файлов хранится в `bot/config/products.py`.

## Система поддержки пользователей

Бот включает систему поддержки пользователей со следующими функциями:

1. Пользователи могут отправить запрос в поддержку через кнопку "Поддержка" в главном меню или командой `/support`
2. Запросы пользователей пересылаются в указанный чат поддержки (настраивается в `SUPPORT_CHAT_ID`)
3. Администраторы поддержки (указанные в `SUPPORT_ADMIN_IDS`) могут:
   - Отвечать на запросы пользователей
   - Закрывать тикеты поддержки
   - Просматривать статистику обращений (команда `/support_stats`)

Настройка системы поддержки производится в файле `bot/config/config.py`.